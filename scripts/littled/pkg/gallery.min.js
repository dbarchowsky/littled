!function(c){var g={allowSorting:!0,editThumbnailURL:"_ajax/images/upload_image.php",linkThumbnailURL:"_ajax/images/set_thumbnail.php",unlinkThumbnailURL:"_ajax/images/unlink_thumbnail.php",deleteThumbnailURL:"_ajax/images/del_image.php",albumListingsURL:"_ajax/images/album_listings.php",galleryListingsURL:"_ajax/images/gallery_listings.php",albumContainer:"",errorContainer:".alert-error:first",statusContainer:".alert-info:first",navigationContainer:".page-links-container",albumFiltersSelector:".album-filters",dialogContainer:"#globalDialog",csrfSelector:"#csrf-token",imageDialogClass:"gallery-dialog",postGalleryUpdateCB:null,dom:{album_container:".album-listings",album_filters:".album-filters form:first",gallery_container:".gallery-listings",gallery_filters:".listings-filters",page_error_container:".alert-error:first",error_container:".alert-error",status_container:"alert-info:first",dialog_container:"tk",filters_form:".album-filters form:first",csrf_selector:"#csrf-token"},listings:{album_listings_uri:"tk",gallery_listings_uri:"tk",album_container:"tk",navigation_container:"tk",album_filters_container:"tk"},thumbnails:{edit_uri:"tk",link_uri:"tk",unlink_uri:"tk",delete_uri:"tk"},edit:{id_param:"abid",title_param:"abti",slug_param:"AlbumSlug",class_param:"type",class_key:"class",csrf_key:"csrf",validate_slug_uri:"/_ajax/utils/validate_slug.php"},keys:{keyword_filter:"flkw",record_id:"id",content_type_id:"tid",parent_id:"pid",album_page:"p",gallery_page:"ip",operation:"op",csrf:"csrf"},previews:{rolloverSelector:".gal-ro",className:"tip-darkgray",alignTo:"target",alignX:"right",alignY:"center",offsetX:8,followCursor:!0,content:function(){var t=c(".tooltip-content",c(this).parent().parent());return t.length<1&&updateCallback("Preview unavailable!"),t.html()}}},o={retrieveGallery:function(n){var r=c.extend(!0,{},g,n||{});return this.each(function(){var i=c(this),a=i.data(r.keys.parent_id),t=i.data(r.keys.content_type_id);if(a)if(t){!1===r.hasOwnProperty("galleryFilters")&&(r.galleryFilters={});var l=c.extend({},r.galleryFilters,{pid:a,tid:t});l[r.edit.csrf_key]=c(r.csrfSelector).html(),c.littled.retrieveContentOperations(t,function(t){var e=t.listings_uri||c.littled.getRelativePath()+g.galleryListingsURL;c.post(e,l,function(t){t.error?c(r.dom.page_error_container).littled("displayError",t.error):(i.html(c.littled.htmldecode(t.content)),i.galleries("bindGalleryHandlers",n),r.hasOwnProperty("animate")&&!0===r.animate&&c("tr.gallery-row[data-id="+a+"]").galleries("animateGalleryToggle",n))},"json").success(function(){r.postGalleryUpdateCB&&r.postGalleryUpdateCB.apply(this,arguments)}).fail(function(t){0!==t.status&&c(r.dom.page_error_container).littled("ajaxError",t)})})}else c(r.dom.page_error_container).littled("displayError","Content type not set.");else c(r.dom.page_error_container).littled("displayError","Parent not set.")})},toggleGallery:function(t,e){var i=c.extend(!0,{},g,e||{}),a=c(this).data("id"),l=c(this).button("option","icons"),n=c("tr.gallery-row[data-id="+a+"]");if(n.length<1)c(i.dom.page_error_container).littled("displayError","Gallery could not be located.");else if("ui-icon-expand"===l.primary)if(c(i.dom.gallery_container+" table:first",n).length<1){var r,o=c(i.dom.album_filters);0<o.length&&(r=o.serializeObject({},["pl","next","filt"]));var s=c.extend({},{pid:a},r||{});c(i.dom.gallery_container,n).galleries("retrieveGallery",{galleryFilters:s,animate:!0})}else{var d=c(i.dom.gallery_container,n);!1===d.hasClass("functional")&&d.galleries("bindGalleryHandlers"),n.galleries("animateGalleryToggle",e),n.galleries("configureSorting",e)}else n.galleries("animateGalleryToggle",e)},animateGalleryToggle:function(t){var a=c.extend(!0,{},g,t||{});return this.each(function(){var t=c(this).data("id"),e=c("#toggle-"+t+"-btn");if("ui-icon-expand"===e.button("option","icons").primary)e.button("option","icons",{primary:"ui-icon-collapse"}),c(this).show(),c(a.dom.gallery_container,c(this)).slideToggle("slow");else{c(a.dom.gallery_container,c(this)).slideToggle("",function(){c(this).hide()});var i=c(a.dom.gallery_container+" table:first",c(this));0<i.length&&i.hasClass("ui-sortable")&&i.sortable("destroy"),e.button("option","icons",{primary:"ui-icon-expand"})}})},bindAlbumListingsHandlers:function(t){var e=c.extend(!0,{},g,t||{});return this.each(function(){c(this).unbind("contentUpdate",o.updateAlbumListingsHandlers).bind("contentUpdate",e,o.updateAlbumListingsHandlers).keywords("bindListingsHandlers").off("click","tr.list",o.toggleListHighlight).on("click","tr.list",o.toggleListHighlight).off("click","tr.list-alt",o.toggleListHighlightAlt).on("click","tr.list-alt",o.toggleListHighlightAlt).off("click",".alb-nav",o.gotoAlbumPage).on("click",".alb-nav",t,o.gotoAlbumPage).off("click",".toggle-pages-btn",o.toggleGallery).on("click",".toggle-pages-btn",o.toggleGallery).off("click",".add-page-btn",o.editImage).on("click",".add-page-btn",t,o.editImage).off("click",".add-page-link",o.editImage).on("click",".add-page-link",t,o.editImage).off("click",".update-cache-btn",c.littled.updateCache).on("click",".update-cache-btn",{errorContainer:e.dom.error_container,statusContainer:e.statusContainer},c.littled.updateCache).off("dblclick",".inline-edit-cell",o.editCell).on("dblclick",".inline-edit-cell",t,o.editCell).off("galleryLoaded",".pages-row",o.retrieveGallery).on("galleryLoaded",".pages-row",t,o.retrieveGallery),!0===e.allowSorting&&c(this).galleries("bindAlbumResorting",t),c(".details-btn",c(this)).iconButton("details"),c(".edit-btn",c(this)).iconButton("edit"),c(".print-btn",c(this)).iconButton("print"),c(".trash-btn",c(this)).iconButton("trash"),c(".preview-btn",c(this)).iconButton("link"),c(".toggle-pages-btn",c(this)).iconButton("expand"),c(".add-page-btn",c(this)).iconButton("addchild"),c(".update-cache-btn",c(this)).iconButton("cache"),c(e.previews.rolloverSelector,c(this)).poshytip(e.previews),c(".img-details-link",c(this)).formDialog({dialogClass:e.imageDialogClass,dom:{listings_container:e.dom.album_container}}),c(".trash-btn",c(this)).formDialog({dialogClass:"ui-dialog-delete",dom:{listings_container:e.dom.album_container}}),c(e.dom.gallery_container).addClass("hidden")})},updateAlbumListingsHandlers:function(t){c(this).galleries("bindAlbumListingsHandlers",t.data||{})},bindGalleryHandlers:function(e){var i=c.extend(!0,{},g,e||{});return this.each(function(){c(this).off("contentUpdate",o.updateGalleryHandlers).on("contentUpdate",i,o.updateGalleryHandlers).galleries("bindFilterElementsHandlers",e).galleries("configureSorting",e).galleries("bindImageOverlayHandlers",e).keywords("bindListingsHandlers",e).off("dblclick",".inline-edit-cell",o.editCell).on("dblclick",".inline-edit-cell",o.editCell).off("click",".add-img-btn",o.editImage).on("click",".add-img-btn",e,o.editImage).off("click",".edit-img-btn",o.editImage).on("click",".edit-img-btn",e,o.editImage).off("click",".update-cache_btn",c.littled.updateCache).on("click",".update-cache_btn",{errorContainer:i.dom.error_container,statusContainer:i.statusContainer},c.littled.updateCache).off("click",".gal-nav",o.gotoGalleryPage).on("click",".gal-nav",e,o.gotoGalleryPage).addClass("functional");var t={dialogClass:i.imageDialogClass,formLoadCB:function(){var e=c(i.dialogContainer+":visible");e.length<1||c(".image-detail").on("click",function(t){t.preventDefault(),e.formDialog("close")})},dom:{listings_container:i.dom.gallery_container}};c(".img-details-btn",c(this)).iconButton("details").formDialog(t),c(".img-details-link",c(this)).formDialog(t),c(".add-img-btn",c(this)).iconButton("addchild"),c(".edit-img-btn",c(this)).iconButton("edit"),c(".delete-img-btn",c(this)).iconButton("trash").formDialog({dialogClass:"ui-dialog-delete",dom:{listings_container:i.dom.gallery_container},callbacks:{update_content:o.updateGalleryListingsContent}}),jQuery().poshytip&&c(i.previews.rolloverSelector,c(this)).poshytip(i.previews),c(".datepicker",c(this)).datepicker()})},updateGalleryHandlers:function(t){var e=c.extend(!0,{},g,t||{});c(this).galleries("bindGalleryHandlers"),e.postGalleryUpdateCB&&e.postGalleryUpdateCB.apply(this,arguments)},updateGalleryListingsContent:function(t){var e=c.extend(!0,{},g,t.settings||{}).dom.gallery_container+"[data-pid="+t.parent_id+"]";t.settings={dom:{listings_container:e}},c(e).listings("updateListingsContent",t)},bindImageOverlayHandlers:function(t){var e=c.extend(!0,{},g,t||{});return this.each(function(){c(this).off("contentUpdate",o.updateImageOverlayHandlers).on("contentUpdate",e,o.updateImageOverlayHandlers).off("click",".img-upload-btn",o.updateThumbnail).on("click",".img-upload-btn",t,o.updateThumbnail).off("click",".sel-galltn-btn",o.updateThumbnail).on("click",".sel-galltn-btn",t,o.updateThumbnail).off("click",".add-img-btn",o.editImage).on("click",".add-img-btn",t,o.editImage).off("click",".gallery-edit",o.bindGalleryEditButtons).off("dblclick",".gallery-edit",o.detailsDialog).on("click",".gallery-edit",t,o.bindGalleryEditButtons).on("dblclick",".gallery-edit",t,o.detailsDialog).off("click",".gallery-tn-container",o.bindThumbnailEditButtons).off("dblclick",".gallery-tn-container",o.detailsDialog).on("click",".gallery-tn-container",t,o.bindThumbnailEditButtons).on("dblclick",".gallery-tn-container",t,o.detailsDialog),c(".img-upload-btn",c(this)).button(),c(".sel-galltn-btn",c(this)).button(),c(".add-img-btn",c(this)).iconButton("addchild")})},updateImageOverlayHandlers:function(t){c(this).galleries("bindImageOverlayHandlers",t.data||{})},bindGalleryEditButtons:function(){var t=c("#img-overlay-btns");if(!(t.length<1)){var e=c(this);e.addClass("active-edit"),c("#edit-overlay-btn").off("click",o.editImage).on("click",o.editImage),c("#edit-overlay-btn").data("id",e.data("id")),c("#edit-overlay-btn").data("pid",e.data("pid")),c("#edit-overlay-btn").data("tid",e.data("tid")),c("#del-overlay-btn").data("id",e.data("id")),c("#del-overlay-btn").data("pid",e.data("pid")),c("#del-overlay-btn").data("tid",e.data("tid")),c("#del-overlay-btn").formDialog({dialogClass:"ui-dialog-delete"});var i=e.offset();t.css("top",i.top+6).css("left",i.left+6).show(),setTimeout(function(){e.removeClass("active-edit"),c("#edit-overlay-btn").off("click",o.editImage),c("#del-overlay-btn").formDialog("cancel"),t.hide()},4e3)}},bindThumbnailEditButtons:function(t){t.preventDefault();var e=t.data||{},i=c("#tn-overlay-btns");if(!(i.length<1)){c(this).addClass("active-edit");var a=c("#edit-galltn-btn"),l=c("#del-galltn-btn");a.on("click",e,o.updateThumbnail),l.on("click",e,o.updateThumbnail),a.data("id",c(this).data("id")),a.data("pid",c(this).data("pid")),a.data("tid",c(this).data("tid")),a.data("op",c(this).data("op")),a.data("rand",c(this).data("rand")),l.data("id",c(this).data("id")),l.data("pid",c(this).data("pid")),l.data("tid",c(this).data("tid")),l.data("op","del-"+c(this).data("op"));var n=c(this).offset();i.css("top",n.top+6).css("left",n.left+6).show();var r=c(this);setTimeout(function(){r.removeClass("active-edit"),a.off("click",o.updateThumbnail),l.off("click",o.updateThumbnail),i.hide()},4e3)}},bindSlugWatch:function(t){var e=c.extend(!0,{},g,t||{});return this.on("blur",e,o.validateSlug)},validateSlug:function(t){var l=c.extend(!0,{},g,t.data||{});c(this).closest("div").children(".alert-error:visible").fadeOut("fast");var n=c(this).closest("form"),e={};e[l.edit.csrf_key]=c(l.csrfSelector).html(),e[l.edit.id_param]=c('input[name="'+l.edit.id_param+'"]',n).val(),e[l.edit.title_param]=c('input[name="'+l.edit.title_param+'"]',n).val(),e[l.edit.slug_param]=c('input[name="'+l.edit.slug_param+'"]',n).val(),e[l.edit.class_key]=c('input[name="'+l.edit.class_param+'"]',n).val(),e[l.edit.id_param]||c(this).attr("name")===l.edit.slug_param&&(e[l.edit.title_param]=e[l.edit.slug_param],e[l.edit.slug_param]=""),c.post(l.edit.validate_slug_uri,e,function(t){if(t.content){var e=c('input[name="'+l.edit.slug_param+'"]',n);e.val(t.content)}if(t.error)if(t.content){var i=e.closest("div");if((a=c(".alert-error",i)).length<1){var a=c('<div class="alert alert-error hidden"></div>');i.prepend(a)}a.html(t.error),a.fadeIn("slow")}else c(l.dom.error_container).littled("displayError",t.error);else;},"json").fail(function(t){c(l.dom.error_container).littled("ajaxError",t)})},editImage:function(t){t.preventDefault(),t.hasOwnProperty("data")&&delete t.data;var e=o.getListingsSelector.apply(this,t.data);t.data={dom:{listings_container:e}},c(this).formDialog("open",t)},getListingsSelector:function(t){var e=c.extend(!0,{},g,t||{});return e.dom.gallery_container+"[data-"+e.keys.parent_id+"="+c(this).data(e.keys.parent_id)+"]"},editCell:function(t){t.stopPropagation(),c(this).listings("editCell",t)},updateThumbnail:function(t){t.preventDefault();var i=t.data||{},a=c.extend(!0,{},g,i),l=c(this).data("op"),e=c(this).formDialog("retrieveFormFilters",t.data||{});if("upload"!==l&&"del-upload"!==l&&void 0===e.pid||void 0===e.tid)c(a.dom.error_container).littled("displayError","Gallery properties not set.");else{e[a.edit.csrf_key]=c(a.csrfSelector).html();var n=o.getThumbnailURI(l,a);c.post(n,e,function(t){var e={formLoadCB:o.displayThumbnailDialog};0===l.indexOf("del")&&(e.dialogClass="ui-dialog-delete"),t.settings=c.extend(!0,{},i,e),!1===c(a.dialogContainer).is(":visible")&&c(a.dialogContainer).formDialog("display",t)},"json").fail(function(t){c(a.dom.error_container).littled("ajaxError",t)})}},displayThumbnailDialog:function(t){var e=c.extend(!0,{},g,t||{});c(e.dialogContainer+" .dlg-commit-btn").off("click"),c(e.dialogContainer+" .dlg-commit-btn").on("click",t,o.commitThumbnailUpdate)},commitThumbnailUpdate:function(e){e.preventDefault();var t,i=c.extend(!0,{},g,e.data||{}),a=c(i.dialogContainer+" form:first"),l=c("input[name=op]",a);if(l.length&&(t=l.val()),t){var n=o.getThumbnailURI(t,i);"select"===t?c.post(n,a.serializeObject(),function(t){t.options=e.data||{},o.processThumbnailUpdate(t)},"json").fail(function(t){c(i.dom.error_container).formDialog("ajaxError",t)}):a.ajaxSubmit({type:"post",url:n,dataType:"json",success:function(t){t.options=e.data||{},o.processThumbnailUpdate(t)},error:function(t){c(i.dom.error_container).littled("ajaxError",t)}})}else c(i.dom.error_container).littled("displayError","Operation not specified.")},processThumbnailUpdate:function(t){var e=c.extend(!0,{},g,t.options||{});if(t.error)c(e.dom.error_container).littled("displayError",t.error);else if(c(e.dialogContainer).formDialog("close"),t.container_id){var i=c(t.container_id);i.length&&(i.html(c.littled.htmldecode(t.content)),c(t.container_id).galleries("bindImageOverlayHandlers"))}},getThumbnailURI:function(t,e){var i=c.extend(!0,{},g,e||{});switch(t){case"upload":case"edit":return c.littled.getRelativePath()+i.editThumbnailURL;case"link":case"select":return c.littled.getRelativePath()+i.linkThumbnailURL;case"unlink":case"del-link":return c.littled.getRelativePath()+i.unlinkThumbnailURL;case"delete":case"del-upload":return c.littled.getRelativePath()+i.deleteThumbnailURL;default:return c(i.dom.error_container).littled("displayError","Unhandled operation."),""}},deleteRecord:function(t){},collectPageNavigationVariables:function(t){var e=c.extend(!0,{},g,t||{}),i={};return i[e.keys.album_page]=c(this).data(e.keys.album_page),i[e.keys.content_type_id]=c(e.dom.album_container+" table:first").data(e.keys.content_type_id),null===i[e.keys.content_type_id]&&(i[e.keys.content_type_id]=c(e.dom.album_container).data(e.keys.content_type_id)),i[e.keys.parent_id]=c(e.dom.album_container+" table:first").data(e.keys.parent_id),i},validatePageNavigationVariables:function(t,e){var i=c.extend(!0,{},g,e||{});return null!==t[i.keys.content_type_id]||(c(i.dom.error_container).littled("displayError","Content type could not be determined through the attributes of the listings container, or the first table nested in the container."),!1)},gotoAlbumPage:function(t){t.preventDefault();var i=t.data||{},a=c.extend(!0,{},g,i),l=c(this).galleries("collectPageNavigationVariables",i);if(!1!==c(this).galleries("validatePageNavigationVariables",l,i)){c(".sm-process-wheel").addClass("sm-active-wheel"),c("#status-container").fadeOut("fast");var n=c(a.dom.album_filters).littled("collectFormDataWithCSRF",t.data||{},l);c.littled.retrieveContentOperations(n[a.keys.content_type_id],function(t){if(t.error)c(a.dom.error_container).littled("displayError",t.error);else{var e=c.littled.getRelativePath()+a.albumListingsURL;t.listings_uri&&(e=t.listings_uri),c.ajax({type:"post",url:e,data:n,dataType:"json"}).success(function(t){t.settings=i,t.page=l[a.keys.album_page],c(a.dom.album_container).galleries("updateAlbumContent",t)}).fail(function(t){c(a.dom.error_container).littled("ajaxError",t)})}})}},updateAlbumContent:function(t){var e=c.extend(!0,{},g,t.settings||{});if(t.error)c(e.dom.error_container).littled("displayError",t.error);else{var i=t.hasOwnProperty("page")?t.page:1;i||(i=1),c(".sm-process-wheel").removeClass("sm-active-wheel");var a=c.Event("contentUpdate");a.data=t.settings||{},c(e.dom.album_container).html(c.littled.htmldecode(t.content)),c(e.dom.album_container).data("p",i).trigger(a)}},gotoGalleryPage:function(t){t.preventDefault();var e=t.data||{},i=c.extend(!0,{},g,e),a=c(this).parents(i.dom.gallery_container+":first"),l=c(i.dom.gallery_filters,a),n={};n[i.keys.parent_id]=a.data(i.keys.parent_id),n[i.keys.album_page]=c(this).data(i.keys.album_page),c("input[name="+i.keys.gallery_page+"]",l).val(n[i.keys.album_page]);var r=c.extend({},n,c("input, select",l).serializeObject());a.galleries("retrieveGallery",c.extend(!0,{},e,{galleryFilters:r,animate:!1}))},configureSorting:function(t){c.extend(!0,{},g,t||{});return this.each(function(){var t=c("table:first",c(this));0<t.length?t.sortable({items:"tr.page-row",update:function(t,e){c(this).resort("resort",t,e)}}):c(this).is("div")&&c(this).sortable({items:".page-cell",update:function(t,e){c(this).resort("resort",t,e)}})})},bindFilterElementsHandlers:function(t){var i=c.extend(!0,{},g,t||{});return this.each(function(){var e=c(".gallery-page-nav:first",c(this));c("input[name="+i.keys.keyword_filter+"]",e).keypress(function(t){13===(window.event?window.event.keyCode:t.which)&&c(".gallery-filter-btn:first",e).trigger("click")}),c(".gallery-filter-btn:first",e).button().off("click",o.submitGalleryFilters).on("click",t,o.submitGalleryFilters)})},bindAlbumResorting:function(a){var l=c.extend(!0,{},g,a||{});return this.each(function(){var t=!1,e=c(l.dom.filters_form);if(0<e.length){var i=e.serializeObject();t=o.hasFilteredListings(i)}!1===t&&c("table:first",c(this)).resort("bindResort",a)})},submitGalleryFilters:function(t){t.preventDefault();var e=t.data||{},i=c.extend(!0,{},g,t.data||{}),a=c(this).closest("form"),l=c("input, select",a).serializeObject();l.hasOwnProperty(i.keys.gallery_page)&&delete l[i.keys.gallery_page],a.closest(i.dom.gallery_container).galleries("retrieveGallery",c.extend(!0,{},e,{galleryFilters:l,animate:!1}))},hasFilteredListings:function(t){var e,i=c.extend({},{p:"",pl:"",filt:"",ifilt:"",next:"",inext:"",ip:"",ipl:""});for(e in t)if(t.hasOwnProperty(e)&&!1===i.hasOwnProperty(e)&&Object.prototype.hasOwnProperty.call(t,e))return!!t[e];return!1},toggleListHighlight:function(){c(this).toggleClass("md")},toggleListHighlightAlt:function(){c(this).toggleClass("md-alt")},bindDialogHandlers:function(){return this.each(function(){c(".dlg-commit-btn",c(this)).button().on("click",cb),c(".dlg-cancel-btn",c(this)).button().on("click",LITTLED.cancel),c(".datepicker",c(this)).datepicker()})}};c.fn.galleries=function(t){return o[t]?o[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(c.error("Method "+t+" does not exist on jQuery.galleries."),!1):o.init.apply(this,arguments)}}(jQuery);