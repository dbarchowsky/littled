"undefined"==typeof LITTLED&&(LITTLED={script_root:"/hostmgr/_ajax/",edit_url:"",delete_url:"",view_url:"",cache_url:"",id_param:"id",progress_html:'<div class="dialog-in-process"></div>',debug:!1,init:function(t){if(void 0!==t)for(var e in t)this[e]=t[e]},ajaxError:function(t){var e=$("#globalDialog");0<e.length&&e.is(":visible")&&e.littled("ajaxError",t)},displayStatus:function(t){t&&$("#status-container").length&&($("#status-container").html(LITTLED.htmldecode(t).replace(/\n/g,"<br />\n")),$("#status-container:hidden").fadeIn("slow"))},doLookup:function(){var t=document.getElementById("dialog-edit-form");return t.url.value?(LITTLED.displayProcessWheel(),$("#dialog-edit-form").ajaxSubmit({url:t.url.value,type:"post",dataType:"json",success:LITTLED.onLoadFormSuccess,error:LITTLED.ajaxError})):alert("url not set!"),!1},updateCache:function(){$.littled.updateCache()},getParentObject:function(t){var e;return void 0===t?e=$("body"):"object"==typeof t?e=t:(e=$(t)).length<1&&(e=$("body")),e},oc:function(t){for(var e={},r=0;r<t.length;r++)e[t[r]]="";return e},ptq:function(t,e){var r,i,n,o=t.replace(/;/g,"&").split("&");for(t={},r=0;r<o.length;r++)n=o[r].split("=",2),i=unescape(n[0]),void 0!==e&&0<=e.length&&i in LITTLED.oc(e)&&(i=""),""!=i&&(t[i]||1<n.length&&(t[i]=unescape(n[1])));return t},getQueryArray:function(t,e){var r=["id","msg"];void 0!==e&&0<=e.length&&(r=r.concat(e));var i=LITTLED.ptq(document.location.search.substring(1).replace(/\+/g," "),r);for(var n in i)""==i[n]&&delete i[n];if(void 0!==t&&"object"==typeof t)for(n in t)i[n]=t[n];return i},getParameterByName:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))},isObjectEmpty:function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},getDomain:function(){return void 0===window.document.domain?window.document.hostname:window.document.domain},bindImageRollovers:function(){$("img.ro").hover(function(){$(this).attr("src",$(this).attr("src").replace(/\.([^.]+)$/,"-over.$1"))},function(){$(this).attr("src",$(this).attr("src").replace(/-over\.([^.]+)$/,".$1"))})},edit_cb:function(t){LITTLED.onEditSuccess(t)},onEditSuccess:function(t){if(LITTLED.clearDialogMsg(),t.error)return LITTLED.displayError(t.error.replace("/\n/mg","<br />\n"),"dialog-error-container");if(t.container_id){var e=$("#"+t.container_id);e.length<1&&(e=$("#listings-container"))}else e=$("#listings-container");return e.length&&(e.html(LITTLED.htmldecode(t.content)),LITTLED.setSortables()),LITTLED.displayStatus(t.status),LITTLED.dismissDialog(),!1},setSortables:function(){},onContentUpdate:function(t){return t.error?LITTLED.displayError(LITTLED.htmldecode(t.error)):($("#"+t.container_id).html(LITTLED.htmldecode(t.content)),!1)},displayAjaxResult:function(t){if(t.error){var e=null;if(void 0!==t.container_id&&""!=t.container_id)(e=$("#"+t.container_id)).html('<div class="error">'+t.error.replace(/\n/gm,"<br />")+"</div>");else{if(!$("#error-container").length)return alert(t.error),!1;(e=$("#error-container")).html(t.error.replace(/\n/gm,"<br />"))}return e.show(),!1}return $("#"+t.container_id).html(LITTLED.htmldecode(t.content)),$("#"+t.container_id).show(),!1},onLoadFormSuccess:function(t){return LITTLED.clearDialogMsg(),t.error?LITTLED.displayError(t.error):($("#global-modal-content").html(LITTLED.htmldecode(t.content)),$("#globalDialog").dialog({title:t.label,minWidth:360,width:"auto",height:"auto",modal:!0}),$("#globalDialog .datepicker").datepicker(),$("#globalDialog .dlg-commit-btn").button().on("click",LITTLED.commitOp),$("#globalDialog .dlg-cancel-btn").button().on("click",LITTLED.cancel),!1)},commitOp:function(){var t=$(this).data("tid"),r=$(this).data("op");return t?r?(LITTLED.execSectionOp(t,function(t){if(t.error)return LITTLED.displayError(t.error,"dialog-error-container");var e="";switch(r){case"edit":e=t.edit_uri;break;case"delete":e=t.delete_uri;break;default:return LITTLED.displayError("Unhandled operation."),!1}return""==e?alert("Handler not set."):(e=$.littled.addProtocolAndDomain(e),$("#dialog-edit-form").ajaxSubmit({url:e,type:"post",dataType:"json",success:LITTLED.edit_cb,error:LITTLED.ajaxError})),!1}),!1):LITTLED.displayError("Operation not specified."):LITTLED.displayError("Content type not specified.")},dialogEdit:function(t,e,i){var n,o,r,a=LITTLED.onLoadFormSuccess;return"function"==typeof t?(a=t,o=(r=e).data("tid")):"object"!=typeof t&&void 0!==t&&"null"!=typeof t||(r=$(this),n=r.data("id"),o=void 0===e?r.data("tid"):e),void 0===i&&(i=r.data("op")),void 0===o?LITTLED.displayError("Content type not set."):void 0===i?LITTLED.displayError("Operation not set."):(LITTLED.execSectionOp(o,function(t){if(t.error)return LITTLED.displayError(t.error);var e=LITTLED.getOperationURI(i,t);if(!e)return LITTLED.displayError("Unsupported operation.");LITTLED.initDialog();var r={tid:o};return r[t.id_param]=n,r=LITTLED.getQueryArray(r),$.ajax({method:"get",url:e,data:r,dataType:"json",success:a,error:LITTLED.ajaxError}),!1}),!1)},cancel:function(t){void 0!==LITTLED.Video&&LITTLED.Video.unhideFLV(t),LITTLED.dismissDialog()},initDialog:function(){void 0!==LITTLED.Video&&LITTLED.Video.hideFLV(),$("#dialog-bg").height($(document).height()),$("#dialog-bg").width($(document).width());var t=$(document).scrollTop();$("#dialog-bg").offset({top:t,left:0}),$("#dialog-bg").show(),$("#dialog-error-container").hide(),$("#dialog-status-container").hide(),$("#dialog-form-container").html(LITTLED.progress_html),$("#dialog-container").show(),LITTLED.center($("#dialog-container"))},dismissDialog:function(){void 0!==LITTLED.Video&&LITTLED.Video.unhideFLV(),$("#globalDialog").dialog("close")},clearDialogMsg:function(){$("#dialog-status-container").hide(),$("#dialog-error-container").hide()},execSectionOp:function(t,e){$.ajax({type:"get",url:LITTLED.script_root+"utils/script_properties.php",dataType:"json",data:{tid:t},success:e,error:LITTLED.ajaxError})},getOperationURI:function(t,e){switch(t){case"edit":return e.edit_uri;case"delete":return e.delete_uri;case"view":return e.details_uri;default:return""}},displayProcessWheel:function(t){void 0===t&&(t="dialog"),$("#"+t+"-error-container").html(""),$("#"+t+"-error-container").hide(),$("#"+t+"-status-container").html(LITTLED.progress_html),$("#"+t+"-status-container").show()},center:function(t){var e=$(document).scrollTop()+$(window).height()/2-t.height()/2,r=$(window).width()/2-t.width()/2;t.offset({top:e,left:r})},formatQueryString:function(){var t=document.location.search.toString();return t=(t=(t=(t=t.replace(/^[\?]/,"&")).replace(new RegExp("&(id|msg|"+LITTLED.id_param+")=.*?&"),"&")).replace(new RegExp("&(id|msg|"+LITTLED.id_param+")=.*$"),"")).replace(/^[\?&]/,"")},htmldecode:function(t){return void 0===t?"":t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')},displayError:function(t,e){var r=void 0!==e&&e?$("#"+e):$("#error-container");return r.length&&r.littled("displayError",t),!1},dismissError:function(t){var e=void 0!==t&&t?$("#"+t):$("#error-container");e.length&&e.is(":visible")&&e.slideToggle("slow")},dialogError:function(t,e){var r=$("#"+(void 0!==e&&e?e:"dialog")+"-status-container");(r.length<1&&(r=$("#status-container")),"dialog-status-container"===r.attr("id")&&$("#dialog-container").is(":hidden")&&(r=$("#status-container")),r.length&&r.hide(),(r=$("#"+(void 0!==e&&e?e:"dialog")+"-error-container")).length<1&&(r=$("#error-container")),"dialog-error-container"===r.attr("id")&&$("#dialog-container").is(":hidden")&&(r=$("#error-container")),r.length)&&(r.html(t.replace(/\n/gm,"<br />")),e||r.html(r.html()+' <input class="smtext" type="button" value="close" onclick="LITTLED.cancel()" />'),r.show(),0<parseInt(r.parent().css("z-index"))&&LITTLED.center(r.parent()))},bindInlineTB:function(){$("input.tbi").each(function(){""===$(this).val()&&$(this).val($(this).data("init"))}),$("input.tbi").on("focus",function(){$(this).val()===$(this).data("init")&&$(this).val("")}).on("blur",function(){""===$(this).val()&&$(this).val($(this).data("init"))})},setInputLabel:function(t,e){t.length<1||(t.focus(function(){$(this).val()===e&&($(this).val(""),$(this).removeClass("dimtext"))}).blur(function(){""===$(this).val()&&($(this).val(e),$(this).addClass("dimtext"))}),t.val()||(t.val(e),t.addClass("dimtext")))},onHTTPFailure:function(t){LITTLED.ajaxError(t)}}),function(a){var o={errorContainer:".alert-error",statusContainer:".alert-info",csrfSelector:"#csrf-token",progress_markup:'<div class="dialog-in-process"></div>',ajax:{content_operations_uri:"_ajax/utils/script_properties.php"},dom:{page_error_container:".alert-error:first"}};a.fn.serializeObject=function(t,e){var r={};return this.each(function(){a.each(a(this).serializeArray(),function(t,e){e.name in r?r[e.name]instanceof Array?r[e.name].push(e.value):r[e.name]=[r[e.name],e.value]:r[e.name]=e.value}),void 0!==e&&a.each(e,function(t,e){e in r&&delete r[e]}),r=a.extend({},r,t||{})}),r},a.fn.setTextboxMessage=function(t){this.littled("setTextboxMessage",t)},a.fn.iconButton=function(t){return this.button({icons:{primary:"ui-icon-"+t},text:!1})},a.fn.allData=function(){var t=jQuery.data(this.get(0));return a.cache[t]},a.littled={getDomain:function(){return void 0===window.document.domain?window.document.hostname:window.document.domain},getRelativePath:function(){var t="",e=window.location.href;if(e=e.replace(/^.*:\/\/.*?\/(.*\/).*$/,"$1"))for(var r=e.split("/").length-1,i=0;i<r;i++)t+="../";return t},addProtocolAndDomain:function(t){return location.protocol+"//"+a.littled.getDomain()+t},htmldecode:function(t){return void 0===t?"":t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')},htmlentities:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},getQueryArray:function(t,e){var r=["id","msg"];void 0!==e&&0<=e.length&&(r=r.concat(e));var i=LITTLED.ptq(document.location.search.substring(1).replace(/\+/g," "),r);for(var n in i)""===i[n]&&delete i[n];if(void 0!==t&&"object"==typeof t)for(n in t)i[n]=t[n];return i},getEventOptions:function(t,e){var r=e||{};return t.hasOwnProperty("data")&&void 0!==t.data&&t.data.hasOwnProperty("options")&&a.extend(r,t.data.options),r},retrieveContentOperations:function(t,e,r){var i=a.extend(!0,{},o,r||{}),n={};n.tid=t,n.csrf=a(i.csrfSelector).html(),a.ajax({type:"post",url:a.littled.getRelativePath()+i.ajax.content_operations_uri,dataType:"json",data:n,success:e}).fail(function(t){a(i.dom.page_error_container).littled("ajaxError",t)})},updateCache:function(t){t.preventDefault();var i=a.extend(!0,{},o,t.data||{});a(i.errorContainer+":visible").fadeOut("fast"),a(i.statusContainer+":visible").fadeOut("fast");var e=a(this).data("tid"),r=a(this).data("id");e?a.littled.retrieveContentOperations(e,function(t){t.error?a(i.errorContainer).littled("displayError",t.error):t.cache_uri?a.post(t.cache_uri,{tid:e,id:r,csrf:a(i.csrfSelector).html()},function(t){t.error?a(i.errorContainer).littled("displayError",t.error):a(i.statusContainer).littled("displayStatus",t.status)},"json").fail(function(t,e,r){a(i.errorContainer).littled("displayError",e+": "+r.message)}):a(i.errorContainer).littled("displayError","Cache handler not set.")},i):a(i.errorContainer).littled("displayError","Content type not specified.")}};var e={displayAjaxResult:function(e){return this.each(function(){if(e.error){var t=a(".error",a(this));0<t.length?t.html(e.error).show():a(this).html(e.error).addClass("error")}else a(this).html(a.littled.htmldecode(e.content)).show()})},displayError:function(t){return t=t.replace(/\n/gm,"<br />").replace(/<br \/>$/,""),t+='<br /><button class="dismiss-btn smtext">dismiss</button>',this.html(t).show("slow"),this.each(function(){var t=a(this);a("button.dismiss-btn",a(this)).click(function(){a(this).unbind("click"),t.hide("fast")})})},ajaxError:function(t){return"200"===t.status?this.little("displayError",a.littled.htmlentities(t.responseText)):this.littled("displayError","["+t.status+" "+t.statusText+"] "+t.responseText)},displayStatus:function(t){return this.each(function(){t&&a(this).show("slow").html(a.littled.htmldecode(t).replace(/\n/g,"<br />\n"))})},dismissError:function(){a(this).html("").hide("fast")},collectFormDataWithCSRF:function(t,e){var r=a.extend({},{csrf:a(t.csrfSelector).html()},e||{});return a.extend(r,a("input, select, textarea",this).serializeObject())},keyNavigation:function(e){return this.on("keydown",function(t){switch(t.keyCode||t.which){case 37:e.backURL&&(t.preventDefault(),window.location=e.backURL);break;case 39:e.nextURL&&(t.preventDefault(),window.location=e.nextURL);break;case 38:e.upURL&&(t.preventDefault(),window.location=e.upURL);break;case 40:e.downURL&&(t.preventDefault(),window.location=e.downURL)}})},setTextboxMessage:function(t){return this.each(function(){""===a(this).val()&&a(this).val(t).addClass("dimtext"),a(this).blur(function(){""===a(this).val()&&a(this).val(t).addClass("dimtext")}).focus(function(){a(this).val()===t&&a(this).val("").removeClass("dimtext")})})},bindImageRollovers:function(){return this.on("mouseenter",function(){a(this).prop("src",a(this).prop("src").replace(/\.([^.]+)$/,"-over.$1"))}).on("mouseleave",function(){a(this).prop("src",a(this).prop("src").replace(/-over\.([^.]+)$/,".$1"))})},displayProcessWheel:function(t){return this.each(function(){var t=a(this).closest("form");a(".error",t).html("").hide("fast"),a(".status",t).html(o.progress_markup).show()})},formatQueryString:function(){var t=document.location.search.toString();return t=(t=(t=(t=t.replace(/^[\?]/,"&")).replace(new RegExp("&(id|msg|"+LITTLED.id_param+")=.*?&"),"&")).replace(new RegExp("&(id|msg|"+LITTLED.id_param+")=.*$"),"")).replace(/^[\?&]/,"")},testAndAddElement:function(i,n,o){return this.each(function(){var t=null;if(n&&!n instanceof Array){if((t=a(this).closest(n)).length<1)return}else n instanceof Array&&(o=n),t=a(this);if(t.first(i).length<1){var e="<div></div>";if(0===i.indexOf("#"))e.addClass(i).substr(1);else{if(0!==i.indexOf("."))return;e.attr("id",i.substr(1))}if(o instanceof Array)for(var r in o)e.addClass(r);t.prepend(e)}})}};a.fn.littled=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void a.error("Method "+t+" does not exist on jQuery.littled"):e.init.apply(this,arguments)}}(jQuery),function(a){var s={event:"click",width:"auto",height:"auto",dialogClass:"",formLoadCB:null,formDismissCB:null,preContentUpdateCB:null,postContentUpdateCB:null,pagesContainer:".pages-container",dialogSelector:"#globalDialog",errorContainer:"#globalDialog .alert-error:first",pageErrorContainer:".alert-error:first",listingsContainer:".listings",navigationContainer:".page-links-container",filtersSelector:".listings-filters form",csrfSelector:"#csrf-token",displayWarnings:!0,keys:{record_id:"id",content_type_id:"tid",parent_id:"pid",operation:"op",page:"p",commit:"commit",cancel:"cancel",csrf:"csrf"},dom:{dialog_container:"#globalDialog",listings_container:".listings",listings_filters:".listings-filters form",dialog_error_container:"#globalDialog .alert-error:first",page_error_container:".alert-error:first",error_container:".alert-error",status_container:".alert-info:first"},callbacks:{update_content:null}},l={init:function(t){var e=a.extend(!0,{},s,t||{});return this.off(e.event,l.open).on(e.event,t,l.open)},cancel:function(t){var e=a.extend(!0,{},s,t||{});return this.off(e.event,l.open)},open:function(t){t.preventDefault();var i=t.data||{},n=a.extend(!0,{},s,i);l.dismissErrorMessages(i);var o={};if(o[n.keys.operation]=n.hasOwnProperty("scriptData")&&n.scriptData.hasOwnProperty(n.keys.operation)?n.scriptData.op:a(this).data("op"),o[n.keys.record_id]=n.hasOwnProperty("scriptData")&&n.scriptData.hasOwnProperty(n.keys.record_id)?n.scriptData.id:a(this).data("id"),o[n.keys.content_type_id]=n.hasOwnProperty("scriptData")&&n.scriptData.hasOwnProperty(n.keys.content_type_id)?n.scriptData.tid:a(this).data("tid"),o.ssid=o[n.keys.content_type_id],o[n.keys.parent_id]=n.hasOwnProperty("scriptData")&&n.scriptData.hasOwnProperty(n.keys.parent_id)?n.scriptData.pid:a(this).data("pid"),o[n.keys.page]=a(n.dom.listings_container+" table:first").data(n.keys.page),o[n.keys.csrf]=a(n.csrfSelector).html(),void 0!==o[n.keys.operation])if(void 0!==o[n.keys.content_type_id]){a(this);a.littled.retrieveContentOperations(o[n.keys.content_type_id],function(t){if(t.error)a(n.dom.page_error_container).littled("displayError",t.error);else{var e=l.getOperationURI(o[n.keys.operation],t);if(e){o[t.id_param]=o[n.keys.record_id],a.extend(o,n.scriptData||{});var r=a(n.dom.listings_filters).formDialog("retrieveFormFilters",i);0<_.size(r)?a.extend(r,o):r=a.littled.getQueryArray(o),delete r.commit,a.ajax({type:"post",url:e,data:r,dataType:"json"}).success(function(t){t.settings=i,a(n.dom.dialog_container).formDialog("display",t)}).fail(function(t){a(n.dom.page_error_container).littled("ajaxError",t)})}else a(n.dom.page_error_container).littled("displayError","Operation handler not specified.")}})}else a(n.dom.page_error_container).littled("displayError","Content type not specified.");else a(n.dom.page_error_container).littled("displayError","Operation not specified.")},display:function(r){var i=a.extend(!0,{},s,r.settings||{});return r.error?(a(i.dom.page_error_container).littled("displayError",r.error),!1):this.each(function(){a("#global-modal-content").html(a.littled.htmldecode(r.content)),a(this).dialog({title:r.label,minWidth:360,width:i.width,height:i.height,dialogClass:i.dialogClass,closeOnEscape:!0,modal:!0,open:function(t,e){a(".ui-widget-overlay").click(function(t){t.preventDefault(),a(i.dom.dialog_container).formDialog("close")}),a(this).formDialog("bindDialogHandlers",r.settings),i.formLoadCB&&i.formLoadCB.apply(this,Array.prototype.slice.call(arguments,1))},close:function(t,e){a(".ui-widget-overlay").unbind("click")}})})},bindDialogHandlers:function(t){var e=a.extend(!0,{},s,t||{});return this.each(function(){a(".datepicker",a(this)).datepicker(),a(".dlg-commit-btn",a(this)).button().on("click",t,l.commitOperation),a(".dlg-cancel-btn",a(this)).button().on("click",t,function(t){t.preventDefault(),a(e.dom.dialog_container).formDialog("close")})})},collectValue:function(t,e){var r=a(this).data(t);if(!r&&("object"!=typeof e&&(e=a(this).closest("form")),e.length)){var i=a('input[name="'+t+'"]',e);i.length&&(r=i.val())}return r},commitOperation:function(t){t.preventDefault();var r=t.data||{},i=a.extend(!0,{},s,r);l.dismissErrorMessages(r);var n=a(this).closest("form"),e=a(this).formDialog("collectValue",i.keys.content_type_id,n),o=a(this).formDialog("collectValue",i.keys.operation,n);e?o?a.littled.retrieveContentOperations(e,function(t){if(t.error)l.displayError(t.error,r);else{var e=l.getOperationURI(o,t);e?(e=a.littled.addProtocolAndDomain(e),i.preContentUpdateCB&&i.preContentUpdateCB.apply(this,Array.prototype.slice.call(arguments,1)),n.ajaxSubmit({url:e,type:"post",dataType:"json",success:function(t){null!==t?(t.settings=r,l.onOperationSuccess(t)):l.displayError("No data returned.",r)},error:l.ajaxError})):l.displayError("Invalid operation.",r)}}):l.displayError("Operation not specified.",r):l.displayError("Content type not specified.",r)},onOperationSuccess:function(t){var e=t.settings||{},r=a.extend(!0,{},s,e);l.dismissErrorMessages(e),t.error?a(r.dom.dialog_error_container).littled("displayError",t.error):(t.settings=e,"function"==typeof r.callbacks.update_content?r.callbacks.update_content.apply(this,Array.prototype.slice.call(arguments)):a(r.dom.listings_container).listings("updateListingsContent",t),r.postContentUpdateCB&&r.postContentUpdateCB.apply(this,arguments),a(r.dom.dialog_container).formDialog("close",e))},close:function(){return this.each(function(){a(this).dialog("close")})},dismissErrorMessages:function(t){var e=a.extend(!0,{},s,t||{});a(e.dom.error_container+":visible").hide("fast"),a(e.dom.page_error_container+":visible").hide("fast"),a(e.dom.dialog_error_container+":visible").hide("fast")},clearPageContent:function(t){var e=a.extend(!0,{},s,t.settings||{});return this.each(function(){t.error?a(e.dom.page_error_container).littled("displayError",t.error):(a(this).html("<div>\x3c!-- --\x3e</div>"),a(e.dom.status_container).littled("displayStatus",t.status))})},retrieveFormFilters:function(t){var e=a.extend(!0,{},s,t||{}),r={};return this.each(function(){r=a(this).serializeObject(),a.extend(r,{id:a(this).data("id"),pid:a(this).data(e.keys.parent_id),tid:a(this).data(e.keys.content_type_id),p:a(e.dom.listings_container+" table:first").data(e.keys.page)})}),r},retrieveContentOperations:function(t,e,r){a.littled.retrieveContentOperations(t,e,r)},clearMessages:function(){return this.each(function(){a(".message",a(this)).html("").hide("fast"),a(".error",a(this)).html("").hide("fast")})},getOperationURI:function(t,e){switch(t){case"edit":return e.edit_uri;case"upload":return e.upload_uri?e.upload_uri:e.edit_uri;case"delete":return e.delete_uri;case"view":case"details":return e.details_uri;default:return""}},ajaxError:function(t,e){var r="["+t.status+" "+t.statusText+"] "+t.responseText;l.displayError(r)},displayError:function(t,e){var r=a.extend(!0,{},s,e||{});a(r.dom.dialog_container).is(":visible")?a(r.dom.dialog_error_container).littled("displayError",t):a(r.dom.page_error_container).littled("displayError",t)}};a.fn.formDialog=function(t){return l[t]?l[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void a.error("Method "+t+" does not exist on jQuery.formDialog"):l.init.apply(this,arguments)}}(jQuery),function(o){var a={edit_uri:"",input_key:"",events:{to_edit:"dblclick",to_commit:"change"},dom:{edit_container:".inline-edit",status_container:".alert-info",page_error_container:".alert-error:first",error_container:".alert-error",csrf_container:"#csrf-token"}},s={init:function(t){var e=o.extend({},a,t||{});return this.each(function(){o(this).off(e.events.to_edit,s.edit).on(e.events.to_edit,t,s.edit)})},edit:function(t){t.preventDefault();var e=t.data,i=o.extend(!0,{},a,e||{}),r=o(this),n={id:o(this).attr("data-id"),csrf:o(i.dom.csrf_container).html()};o.ajax({type:"post",url:i.edit_uri,data:n,dataType:"json"}).success(function(t){if(t.error)o(i.dom.error_container,r).littled("displayError",t.error);else switch(r.html(o.littled.htmldecode(t.content)),i.events.to_commit){case"change":o("select[name="+i.input_key+"]").on("change",e,s.commitEdit);break;case"key":break;default:o(i.dom.page_error_container).littled("displayError","Unhandled event.")}}).fail(function(t,e,r){o(i.dom.page_error_container).littled("displayError",e+": "+r.message)})},commitEdit:function(t){t.preventDefault();var i=o.extend(!0,{},a,t.data||{}),e=o(this).closest("form").serializeObject();o.extend(e,{csrf:o(i.dom.csrf_container).html()});var r=o(this);o.ajax({type:"post",url:i.edit_uri,data:e,dataType:"json"}).success(function(t){r.closest(i.dom.edit_container).littled("displayAjaxResult",t)}).fail(function(t,e,r){o(i.dom.page_error_container).littled("displayError",e+": "+r.message)})}};o.fn.inlineEdit=function(t){if("extendMethods"===t)o.extend(!0,s,arguments[1]);else{if(s[t])return s[t].apply(this,Array.prototype.slice.call(arguments,1));if("object"==typeof t||!t)return s.init.apply(this,arguments);o.error("Method "+t+" does not exist on jQuery.inlineEdit.")}return!1}}(jQuery),function(o){var a={parentSelector:".line-items-container",lineSelector:".line-item",statusSelector:".alert-info",errorSelector:".alert-error",emptySetSelector:".empty-set",csrfSelector:"#csrf-token",insertLocation:"before",commitParam:"commit",cancelParam:"cancel",currentOperation:"edit",add:{selector:".add-line-btn",event:"click",button:"plus",callback:null,verbose:!1,uri:o.littled.addProtocolAndDomain("/_ajax/utils/edit_line_item.php")},edit:{selector:".line-item",event:"dblclick",button:"",callback:null,verbose:!1,uri:o.littled.addProtocolAndDomain("/_ajax/utils/edit_line_item.php")},del:{selector:".delete-line-btn",event:"click",button:"trash",callback:null,verbose:!0,uri:o.littled.addProtocolAndDomain("/_ajax/utils/delete_line_item.php")},save:{selector:".save-line-btn",event:"click",button:"circle-check",callback:null,verbose:!1,uri:o.littled.addProtocolAndDomain("/_ajax/utils/edit_line_item.php")},cancel:{selector:".cancel-line-btn",event:"click",button:"circle-close",callback:null,verbose:!1,uri:o.littled.addProtocolAndDomain("/_ajax/utils/edit_line_item.php")},callbacks:{postContentInsert:null}},r={init:function(t){var e=o.extend({},a,t||{});return"function"!=typeof e.add.callback&&(e.add.callback=r.edit),"function"!=typeof e.edit.callback&&(e.edit.callback=r.edit),"function"!=typeof e.del.callback&&(e.del.callback=r.remove),"function"!=typeof e.save.callback&&(e.save.callback=r.save),"function"!=typeof e.cancel.callback&&(e.cancel.callback=r.cancel),this.each(function(){o(this).off(e.add.event,e.add.selector,e.add.callback).off(e.edit.event,e.edit.selector,e.edit.callback).on(e.add.event,e.add.selector,t,e.add.callback).on(e.edit.event,e.edit.selector,t,e.edit.callback),"click"===e.add.event&&o(e.add.selector,o(this)).iconButton(e.add.button),"click"===e.edit.event&&o(e.edit.selector,o(this)).iconButton(e.edit.button),"click"===e.del.event&&o(e.del.selector,o(this)).iconButton(e.del.button),e.hasOwnProperty("postInit")&&o(this).lineitems(e.postInit)})},edit:function(t){t.preventDefault();var e=t.data||{},r=o.extend(!0,{},a,e),i=o(this);i.lineitems("resetMessages",r);var n={id:o(this).data("id"),pid:o(this).data("pid"),class:o(this).data("type"),var:o(this).data("var"),csrf:o(r.csrfSelector).html()};o.ajax({type:"post",url:r.edit.uri,data:n,dataType:"json"}).success(function(t){t.settings=e,i.lineitems("insertEditFormMarkup",t)}).fail(function(t,e,r){i.lineitems("displayError",e+": "+r.message)})},remove:function(t){t.preventDefault();var e=t.data||{},r=o.extend(!0,{},a,e);r.currentOperation="delete";var i=o(this).closest(r.lineSelector);i.lineitems("resetMessages",r);var n=o(this).closest("form").littled("collectFormDataWithCSRF",r);n.hasOwnProperty(r.commitParam)&&delete n[r.commitParam],o.ajax({type:"post",url:r.del.uri,data:n,dataType:"json"}).success(function(t){t.settings=e,t.settings.currentOperation="delete",i.lineitems("insertEditFormMarkup",t)}).fail(function(t,e,r){i.lineitems("displayError",e+": "+r.message)})},save:function(t){t.preventDefault();var e=o.extend({},a,t.data||{}),i=o(this).closest(e.lineSelector);i.lineitems("resetMessages",e);o.post(e.save.uri,i.littled("collectFormDataWithCSRF",e),function(t){t.settings=e,i.lineitems("insertLineItemMarkup",t)},"json").fail(function(t,e,r){i.lineitems("displayError",e+": "+r.message)})},commitDelete:function(t){t.preventDefault();var e=o.extend({},a,t.data||{}),i=o(this).closest(e.lineSelector);i.lineitems("resetMessages",e);var r=i.littled("collectFormDataWithCSRF",e);o.ajax({type:"post",url:e.del.uri,data:r,dataType:"json"}).success(function(t){t.error?i.lineitems("displayError",t.error,e):(0<i.length&&i.slideToggle("fast",function(){o(this).remove()}),t.status&&e.del.verbose&&i.lineitems("displayStatus",t.status,e))}).fail(function(t,e,r){i.lineitems("displayError",e+": "+r.message)})},cancel:function(t){t.preventDefault();var e=o.extend({},a,t.data||{}),i=o(this).closest(".line-item");i.lineitems("resetMessages",e);var r=i.littled("collectFormDataWithCSRF",e,{cancel:"1"});r.hasOwnProperty(e.commitParam)&&delete r[e.commitParam];o.post(e.cancel.uri,r,function(t){t.settings=e,i.lineitems("insertLineItemMarkup",t)},"json").fail(function(t,e,r){i.lineitems("displayError",e+": "+r.message)})},insertLineItemMarkup:function(r){var i=r.settings||a;if(!r.error)return this.each(function(){var t=o(o.littled.htmldecode(r.content));if(0<t.length){o(this).fadeOut("fast",function(){o(this).replaceWith(t),t.fadeIn("slow")});var e=t.closest(i.parentSelector);e.lineitems("bindNewItemHandlers",i),o(i.emptySetSelector,e).remove(),r.status&&i.save.verbose&&e.lineitems("displayStatus",r.status)}else o(this).fadeOut("fast",function(){o(this).remove()})});this.lineitems("displayError",r.error)},insertEditFormMarkup:function(r){var i=o.extend(!0,{},a,r.settings||{});if(!r.error)return this.each(function(){var t=o(o.littled.htmldecode(r.content));if(t.length){if(r.id)o(this).fadeOut("fast",function(){o(this).replaceWith(t),t.fadeIn("slow")});else{var e=o(this).closest(i.parentSelector);0<e.length&&("before"===i.insertLocation?0<o("header",e).length?o("header",e).after(t):e.prepend(t):e.append(t))}switch(i.currentOperation){case"delete":t.lineitems("bindDeleteFormHandlers");break;default:t.lineitems("bindEditFormHandlers"),"function"==typeof i.callbacks.postContentInsert&&i.callbacks.postContentInsert.apply(t)}}});this.lineitems("displayError",r.error)},bindNewItemHandlers:function(t){return this.each(function(){o(this).lineitems("bindActionHandler",t.edit)})},bindEditFormHandlers:function(t){var e=o.extend({},a,t||{});return this.each(function(){o(".datepicker",o(this)).datepicker(),o(this).lineitems("bindActionHandler",e.save),o(this).lineitems("bindActionHandler",e.del),o(this).lineitems("bindActionHandler",e.cancel)})},bindDeleteFormHandlers:function(t){var e=o.extend({},a,t||{});return this.each(function(){o(e.del.selector,o(this)).iconButton(e.del.button).off(e.del.event,r.commitDelete).on(e.del.event,r.commitDelete),o(this).lineitems("bindActionHandler",e.cancel)})},bindActionHandler:function(t){return this.each(function(){"click"===t.event&&o(t.selector,o(this)).iconButton(t.button),o(t.selector,o(this)).off(t.event,t.callback).on(t.event,t.callback)})},displayError:function(r,t){var i=o.extend({},a,t||{});return this.each(function(){var t=null;t=o(this).is("button")?o(this).closest(i.parentSelector):o(this);var e=o(i.errorSelector,t);e.length<1&&(o(this).prepend('<div class="alert '+i.errorSelector.replace(/^\./,"")+'"></div>'),e=o(i.errorSelector,o(this))),e.is(":visible")?e.slideToggle("fast",function(){o(this).html(r).slideToggle("slow")}):e.html(r).slideToggle("slow")})},displayStatus:function(e,t){var r=o.extend({},a,t||{});return this.each(function(){var t=o(r.statusSelector,o(this));0<t.length&&(t.is(":visible")?t.slideToggle("fast",function(){o(this).html(e).slideToggle("slow")}):t.html(e).slideToggle("slow"))})},resetMessages:function(r){return this.each(function(){var t=o(r.statusSelector,o(this)).is(":visible"),e=o(r.errorSelector,o(this)).is(":visible");0<t.length&&t.slideToggle("fast"),0<e.length&&e.slideToggle("fast")})}};o.fn.lineitems=function(t){if("extendMethods"===t)o.extend(!0,r,arguments[1]);else{if(r[t])return r[t].apply(this,Array.prototype.slice.call(arguments,1));if("object"==typeof t||!t)return r.init.apply(this,arguments);o.error("Method "+t+" does not exist on jQuery.lineitems.")}return!1}}(jQuery),function(a){var s={displayWarnings:!0,inlineOps:{nameURL:"_ajax/utils/edit_name.php",dateURL:"_ajax/utils/edit_date.php",accessURL:"_ajax/utils/edit_access.php",slotURL:"_ajax/utils/edit_slot.php",pageURL:"_ajax/utils/edit_page.php",statusURL:"_ajax/utils/edit_status.php"},uris:{edit_name:"",record_details:"details.php"},listingsContainer:"[deprecated]",pagesContainer:"[deprecated]",errorContainer:"[deprecated]",statusContainer:"[deprecated]",filtersSelector:"[deprecated]",sortableSelector:"[deprecated]",keys:{record_id:"id",parent_id:"pid",content_type:"tid",page:"p",operation:"op",csrf:"csrf"},dom:{listings_container:".listings",pages_container:".pages-container",page_error_container:".alert-error:first",error_container:".alert-error",status_container:".alert-info:first",filters_form:".listings-filters:first form",sortable_selector:"tr.rec-row",csrfSelector:"#csrf-token"}},l={bindListingsHandlers:function(t){var e=a.extend(!0,{},s,t||{});return this.each(function(){a(this).off("contentUpdate",l.listingsUpdateCB).on("contentUpdate",e,l.listingsUpdateCB).off("dblclick",".inline-edit-cell",l.editCell).on("dblclick",".inline-edit-cell",t,l.editCell).off("click",".page-btn",l.gotoPage).on("click",".page-btn",t,l.gotoPage).off("click",".details-cell",l.gotoDetailsPage).on("click",".details-cell",t,l.gotoDetailsPage).off("click","button.update-cache-btn",a.littled.updateCache).on("click","button.update-cache-btn",{errorContainer:e.dom.error_container,statusContainer:e.dom.status_container},a.littled.updateCache),a("button.edit-btn",a(this)).formDialog("cancel",t).formDialog(t),a("button.trash-btn",a(this)).formDialog("cancel",t).formDialog(a.extend({},t,{dialogClass:"ui-dialog-delete"})),a(".edit-btn",a(this)).iconButton("edit"),a(".details-btn",a(this)).iconButton("details"),a(".preview-btn",a(this)).iconButton("link"),a(".print-btn",a(this)).iconButton("print"),a(".update-cache-btn",a(this)).iconButton("cache"),a(".trash-btn",a(this)).iconButton("trash")})},listingsUpdateCB:function(t){a(this).listings("bindListingsHandlers",t.data||{})},editCell:function(t){t.preventDefault();var e=a.extend(!0,{},s,t.data||{}),r=a(this).parent(),i=a(this).data(e.keys.operation),n={t:a(this).data("t")};n[e.keys.record_id]=a(this).data(e.keys.record_id),n[e.keys.operation]=i,n[e.keys.csrf]=a(e.dom.csrfSelector).html();var o=l.getInlineURL(i,t.data||{});a.post(o,n,function(t){t.error?a(e.dom.error_container).littled("displayError",t.error):(r.html(a.littled.htmldecode(t.content)),r.listings("bindEditHandlers"),"date"===i&&a(".datepicker",r).datepicker({onClose:l.saveEdit}))},"json").fail(function(t){a(e.dom.error_container).littled("ajaxError",t)})},bindEditHandlers:function(){return this.each(function(){a("input[type=text],input[type=number]",a(this)).off("keyup",l.testKeyedEntry).off("keypress",l.testKeyedEntry).off("commit",l.saveEdit).on("keyup",l.testKeyedEntry).on("keypress",l.testKeyedEntry).on("commit",l.saveEdit),a("select",a(this)).off("change",l.saveEdit).on("change",l.saveEdit)})},testKeyedEntry:function(t){var e=a(this).data("id"),r=a(this).data("t"),i=a(this).data("op"),n=a(this).closest(".inline-edit-cell").parent();switch(window.event?window.event.keyCode:t.which){case 13:t.preventDefault(),a(this).trigger("commit");break;case 27:t.preventDefault();var o=l.getInlineURL(i);a.ajax({type:"get",url:o,data:{id:e,t:r,op:i,cancel:1},dataType:"json",success:function(t){t.error?a(s.dom.error_container).littled("displayError",t.error):n.html(a.littled.htmldecode(t.content))},error:function(t){a(s.dom.error_container).littled("ajaxError",t)}})}},saveEdit:function(t){var e=a.extend({},s,t||{}),r=a(this).data("op"),i=a(this).closest("form"),n=a(this).closest(".inline-edit-cell").parent(),o=l.getInlineURL(r,t);a.ajax({type:"post",url:o,data:i.serializeObject(),dataType:"json",success:function(t){t.error?a(e.dom.error_container).littled("displayError",t.error):(n.html(a.littled.htmldecode(t.content)),a(".inline-edit-cell",n).off("dblclick",l.editCell).on("dblclick",l.editCell))},error:function(t){a(e.dom.error_container).littled("ajaxError",t)}})},getInlineURL:function(t,e){var r,i=a.extend({},s,e||{});switch(t){case"name":r=a.littled.getRelativePath()+i.inlineOps.nameURL;break;case"date":r=a.littled.getRelativePath()+i.inlineOps.dateURL;break;case"access":r=a.littled.getRelativePath()+i.inlineOps.accessURL;break;case"slot":r=a.littled.getRelativePath()+i.inlineOps.slotURL;break;case"page":r=a.littled.getRelativePath()+i.inlineOps.pageURL;break;case"status":r=a.littled.getRelativePath()+i.inlineOps.statusURL;break;default:a(s.dom.error_container).littled("displayError","Invalid operation: "+t)}return r},saveDate:function(t,e,r){var i=t.data||{},n=a.extend(!0,{},s,i),o=a(this).parents("form:first");a.post(a.littled.getRelativePath()+s.date_url,o.serializeObject(),function(t){t.settings=i,a(n.dom.listings_container).listings("updateListingsContent",t)},"json").fail(function(t){a(n.dom.page_error_container).littled("ajaxError",t)})},updateListingsContent:function(t){var e=a.extend(!0,{},s,t.settings||{});if(t.error)a(e.dom.error_container).littled("displayError",t.error);else{var r=e.dom.listings_container||t.container_id,i=a(r);0<i.length?i.html(a.littled.htmldecode(t.content)).triggerHandler("contentUpdate"):!0===e.displayWarnings&&a(e.dom.error_container).littled("displayError",'Content container not found: "'+r+'"'),a(e.dom.status_container).littled("displayStatus",t.status)}},gotoPage:function(t){t.preventDefault();var e=t.data||{},r=a.extend(!0,{},s,e);a(r.dom.status_container).fadeOut("fast");var i=a(r.dom.listings_container),n=a(r.dom.filters_form).littled("collectFormDataWithCSRF",t.data||{});n[r.keys.page]=a(this).data(r.keys.page),n[r.keys.content_type]=a("table:first",i).data(r.keys.content_type),n[r.keys.parent_id]=a("table:first",i).data(r.keys.parent_id),a.littled.retrieveContentOperations(n[r.keys.content_type],function(t){t.error?a(r.dom.page_error_container).littled("displayError",t.error):t.listings_uri?a.post(t.listings_uri,n,function(t){t.error?a(r.dom.page_error_container).littled("displayError",t.error):(a(r.dom.listings_container).littled("displayAjaxResult",t).triggerHandler("contentUpdate"),l.updateNavigationValue(r.keys.page,n[r.keys.page],e))},"json").fail(function(t){a(r.dom.page_error_container).littled("ajaxError",t)}):a(r.dom.page_error_container).littled("displayError","Handler not defined.")})},gotoDetailsPage:function(t){t.preventDefault();var e=a.extend(!0,{},s,t.data||{}),r=a(this).data(e.keys.record_id);if(r)if(""!==e.uris.record_details){var i=e.uris.record_details+"?"+e.keys.record_id+"="+r+"&"+a(e.dom.filters_form).serialize();window.location=i}else a(this).closest(e.dom.error_container).littled("displayError","An URI was not provided.");else a(this).closest(e.dom.error_container).littled("displayError","A record id was not provided.")},updateNavigationValue:function(t,e,r){a.extend(!0,{},s,r||{});var i,n=window.location.href,o=new RegExp("([?|&])"+t+"=.*?(&|$)","i");i=n.match(o)?n.replace(o,"$1"+t+"="+e+"$2"):n+(0<n.indexOf("?")?"&":"?")+t+"="+e,history.pushState(null,null,i)},bindKeyPageNavigation:function(e){return this.on("keydown",function(t){switch(t.keyCode||t.which){case 37:e.hasOwnProperty("leftKeyURL")&&e.leftKeyURL&&(window.location=e.leftKeyURL);break;case 39:e.hasOwnProperty("rightKeyURL")&&e.rightKeyURL&&(window.location=e.rightKeyURL);break;case 38:e.hasOwnProperty("upKeyURL")&&e.upKeyURL&&(window.location=e.upKeyURL);break;case 40:e.hasOwnProperty("downKeyURL")&&e.downKeyURL&&(window.location=e.downKeyURL)}})}};a.fn.listings=function(t){return l[t]?l[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(a.error("Method "+t+" does not exist on jQuery.listings."),!1):l.init.apply(this,arguments)}}(jQuery),function(a){var s={progressMarkup:'<div class="dialog-in-process"></div>',parentContainer:".kw-container",contentContainer:".kw-cell",errorContainer:".alert-error",statusContainer:".kw-status-container",csrfSelector:"#csrf-token"},e={bindListingsHandlers:function(t){return this.each(function(){a(this).off("contentUpdate",e.updateListingsHandlers).on("contentUpdate",t,e.updateListingsHandlers).off("click",".edit-kw-btn",e.edit).on("click",".edit-kw-btn",t,e.edit).off("click",".kw-commit-btn",e.save).off("click",".kw-cancel-btn",e.cancel).on("click",".kw-commit-btn",t,e.save).on("click",".kw-cancel-btn",t,e.cancel),a(".edit-kw-btn",a(this)).iconButton("edit")})},updateListingsHandlers:function(t){a(this).keywords("bindListingsHandlers",t.data||{})},bindEditButtons:function(){return this.each(function(){var t=a("textarea",a(this));t.height(t.prop("scrollHeight")),a(".kw-commit-btn",a(this)).iconButton("circle-check"),a(".kw-cancel-btn",a(this)).iconButton("circle-close")})},edit:function(t){t.preventDefault(),t.stopPropagation();var r=a.extend(!0,{},s,t.data||{});a(r.errorContainer+":visible").slideToggle("fast");var i=a(this).closest(r.parentContainer),n=a(this).data("id"),o=a(this).data("tid");o?a.littled.retrieveContentOperations(o,function(t){if(t.error)a(r.errorContainer).littled("displayError",t.error);else if(t.keywords_uri){var e={csrf:a(r.csrfSelector).html(),kwpi:n,kwti:o};a.post(t.keywords_uri,e,function(t){t.settings=r,i.keywords("updateKeywordContent",t,function(){i.keywords("bindEditButtons")})},"json").fail(function(t){i.littled("ajaxError",t)}),i.keywords("displayProcessWheel")}else a(r.errorContainer).littled("displayError","Handler not set.")}):a(r.errorContainer).littled("displayError","Content type not set.")},displayError:function(t,e){var r=a.extend(!0,{},s,e||{});return this.each(function(){a(this).keywords("hideProcessWheel"),a(r.errorContainer,a(this)).littled("displayError",t)})},save:function(t){t.preventDefault();var r=a.extend(!0,{},s,t.data||{});a(r.errorContainer+":visible").slideToggle("fast");var i=a(this).closest(r.parentContainer),n=a(this).parents("form:first"),e=a(this).data("tid");a.littled.retrieveContentOperations(e,function(t){var e=n.serializeObject({csrf:a(r.csrfSelector).html()});a.post(t.keywords_uri,e,function(t){t.settings=r,i.keywords("updateKeywordContent",t,function(){i.trigger("contentUpdate")})},"json").fail(function(t){i.littled("ajaxError",t)})})},cancel:function(t){t.preventDefault();var i=a.extend(!0,{},s,t.data||{}),n=a(this).closest(i.parentContainer),o=a(this).parents("form:first"),e=a(this).data("tid");a(this).formDialog("retrieveContentOperations",e,function(t){var e={cancel:"1",csrf:a(i.csrfSelector).html()},r=o.serializeObject(e,["commit"]);a.post(t.keywords_uri,r,function(t){t.settings=i,n.keywords("updateKeywordContent",t,function(){n.trigger("contentUpdate")})},"json").fail(function(t){n.littled("ajaxError",t)})})},updateKeywordContent:function(e,r){var i=a.extend(!0,{},s,e.settings||{});return this.each(function(){if(e.error)a(i.errorContainer,a(this)).littled("displayError",e.error);else{a(i.errorContainer+":visible",a(this)).hide(),a(i.statusContainer+":visible",a(this)).hide();var t=a(i.contentContainer,a(this));0<t.length?t.html(a.littled.htmldecode(e.content)):a(this).keywords("displayError","Keyword container ("+i.contentContainer+") not found. "),"function"==typeof r&&r()}})},displayProcessWheel:function(t){var e=a.extend(!0,{},s,t||{});return this.each(function(){a(e.errorContainer,a(this)).fadeOut("fast"),a(e.statusContainer,a(this)).fadeIn("slow").html(e.progressMarkup)})},hideProcessWheel:function(t){var e=a.extend({},s,t||{});return this.each(function(){a(e.statusContainer,a(this)).fadeOut("fast")})}};a.fn.keywords=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void a.error("Method "+t+" does not exist on jQuery.listings."):e.init.apply(this,arguments)}}(jQuery),function(s){var l={uris:{keyword_autocomplete:"_ajax/utils/keyword_autocomplete.php",record_details:"details.php"},keys:{record_id:"id",parent_id:"pid",content_type:"tid",page:"p",operation:"op",csrf:"csrf"},dom:{listings_container:".listings",page_error_container:".alert-error:first",error_container:".alert-error",filters_form:".listings-filters:first form",csrf_selelctor:"#csrf-token"},selectCallback:null},e={bindAutocomplete:function(t){var n=s.extend(!0,{},l,t||{});return"function"!=typeof n.selectCallback&&(n.selectCallback=e.selectCallback),this.each(function(){var t=s(this).prop("name"),i={};i[n.keys.content_type]=s(this).data(n.keys.content_type),i[n.keys.csrf]=s(n.dom.csrf_selector).html(),s(this).autocomplete({minLength:3,source:function(e,r){i[t]=e.term,s.ajax({type:"post",url:s.littled.getRelativePath()+n.uris.keyword_autocomplete,data:i,dataType:"json"}).success(function(t){t.error?s(n.dom.page_error_container).littled("displayError",t.error):r(s.map(t,function(t){return{item:t.id,label:t.title,value:t.id,term:e.term}}))}).fail(function(t){s(n.dom.page_error_container).littled("ajaxError",t)})},select:n.selectCallback})})},selectCallback:function(t,e){var r=s.extend(!0,{},l,t.data||{});t.preventDefault(),s(this).val(e.item.term+"*");var i=e.item.value,n=s(r.dom.filters_form).serializeArray(),o=s.map(n,function(t){return t.name+"="+encodeURIComponent(t.value)}),a=r.uris.record_details+"?"+o.join("&")+"&id="+i;window.location=a}};s.fn.keywordFilter=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(s.error("Method "+t+" does not exist on jQuery.keywordFilter."),!1):e.init.apply(this,arguments)}}(jQuery),function(u){var o={uris:{resort:"/_ajax/utils.resort.php"},dom:{listings_container:".listings",sortable_selector:"tr.rec-row",status_container:".alert-info:first",page_error_container:".alert-error:first",error_container:".alert-error",filters_form:".listings-filters:first form",csrf_selector:"#csrf-token"},keys:{record_id:"id",parent_id:"pid",content_type:"tid",page_size:"pl",position_offset:"po",operation:"op",csrf:"csrf"}},e={init:function(r){var n=u.extend(!0,{},o,r||{});return this.each(function(){u(this).sortable({items:n.dom.sortable_selector,start:function(t,e){u(n.dom.status_container+":visible").fadeOut("fast");var r=e.helper.data("rid");if(r){var i=u("#pages-row-"+r);i.length<1||i.is("visible")&&(i.addClass("reopen"),i.hide())}},update:function(t,e){t.data=r,u(this).resort("resort",t,e)}})})},bindResort:function(){return e.init.apply(this,arguments)},resort:function(t,i){var c=t.data||{},d=u.extend(!0,{},o,c);return this.each(function(){u(d.dom.page_error_container).hide();var n=i.item.attr("id");n&&(n="#"+n),u(this).resort("refreshSortableRowStyles",n),u(this).sortable("disable"),u(this).parent().children(".progress-msg").show().position({my:"center",at:"center",of:u(this).parent()});var o=u(this).data(d.keys.content_type),a=u(this).data(d.keys.position_offset);if(void 0===o||void 0===a)return u(d.dom.page_error_container).littled("displayError","Section id or page offset values not set!"),void u(this).resort("rollbackSort",n);var t,s=new Array,e=u(this).sortable("toArray");if(0<e.length)for(var r in e)e[r]&&(t=u("#"+e[r]).data("rid"),0<parseInt(t)&&s.push(t));if(s.length<1)u(this).resort("rollbackSort",n);else{var l=u(this);u.littled.retrieveContentOperations(o,function(t){if(t.error)u(d.dom.page_error_container).littled("displayError",t.error);else if(t.sorting_uri){var e={},r=u(d.dom.filters_form);0<r.length&&(e=r.littled("collectFormDataWithCSRF",d));var i={ssid:o,rid:n};i[d.keys.parent_id]=u(this).data(d.keys.parent_id),i[d.keys.record_id]=JSON.stringify(s),i[d.keys.position_offset]=a,u.extend(e,i),u.post(t.sorting_uri,e,function(t){t.settings=c||{},l.resort("onResortComplete",t)},"json").fail(function(t){u(d.dom.page_error_container).littled("ajaxError",t)})}else u(d.dom.page_error_container).littled("displayError","Handler not defined.")})}})},refreshSortableRowStyles:function(n){return this.each(function(){if(!1!==u(this).is("table")&&(u("tr.rec-row:odd",u(this)).removeClass("list list-alt").addClass("list"),u("tr.rec-row:even",u(this)).removeClass("list list-alt").addClass("list-alt"),u("tr.page-row:odd",u(this)).removeClass("list list-alt").addClass("list"),u("tr.page-row:even",u(this)).removeClass("list list-alt").addClass("list-alt"),n)){var t=u(n);if(t.length<1)return;var e=t.prev();if(e.length<0)return;var r=e.data("rid"),i=u("#pages-row-"+r);if(0<i.length&&i.is(":hidden")&&i.insertAfter(e),r=t.data("rid"),(i=u("#pages-row-"+r)).length<1)return;i.insertAfter(t),i.hasClass("reopen")&&(i.slideToggle(),i.removeClass("reopen"))}})},onResortComplete:function(t){var e=t.settings||{},r=u.extend(!0,{},o,e);return this.each(function(){if(u(this).parent().children(".progress-msg").hide(),t.error)return u(this).resort("rollbackSort",t.id),void u(r.dom.page_error_container).littled("displayError",t.error);u(this).resort("refreshSortableRowStyles").sortable("enable"),t.status&&u(r.dom.status_container).littled("displayStatus",t.status)})},onResortFailure:function(t,e){var r=u.extend({},o,e||{});return u(r.dom.page_error_container).littled("displayError",t.responseText),this.each(function(){u(this).parent().children(".progress-msg").hide(),u(this).sortable("enable")})},rollbackSort:function(t,e){return e&&e.hide(),this.each(function(){u(this).sortable("cancel").sortable("enable").resort("refreshSortableRowStyles",t)})}};u.fn.resort=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(u.error("Method "+t+" does not exist on jQuery.resort."),!1):e.init.apply(this,arguments)}}(jQuery);